#!/bin/bash

start_time=$(date +%s)

source "${PWD}/post_install_scripts/files_containing_addresses.sh"

escape_special_chars() {
    echo "$1" | sed 's/[^^]/[&]/g; s/\^/\\^/g'
}

# DEFAULT OPTMISM ADDRESSES
WETH_ADDRESS_="0x4200000000000000000000000000000000000006"
USDC_ADDRESS_="0x0b2C639c533813f4Aa9D7837CAf62653d097Ff85"
USDT_ADDRESS_="0x94b008aA00579c1307B0EF2c499aD98a8ce58e58"
WBTC_ADDRESS_="0x68f180fcCe6836688e9084f035309E29Bf0A2095"
DAI_ADDRESS_="0xDA10009cBd5D07dd0CeCc66161FC93D7c9000da1"
USDC_OPTIMISM_MIGRATION3_="0x7F5c764cBc14f9669B88837ca1490cCa17c31607"
FACTORY_ADDRESS_="0x1F98431c8aD98523631AE4a59f267346ea31F984"
SWAP_ROUTER_ADDRESS_="0x68b3465833fb72A70ecDF485E0e4C7bD8665Fc45"
POSITION_MANAGER_ADDRESS_="0xC36442b4a4522E871399CD717aBDD847Ab11FE88"
MULTICALL_ADDRESS_="0x1F98415757620B543A52E61c46B32eB19261F984"
QUOTER_ADDRESS_="0x61fFE014bA17989E743c5F6cB21bF9697530B21e"
V3_MIGRATOR_ADDRESS_="0xA5644E29708357803b5A882D272c41cC0dF92B34"
SUBGRAPH_URL_="https://api.thegraph.com/subgraphs/name/ianlapham/optimism-post-regenesis"
RPC_URL_="https://mainnet.optimism.io/"


# ADDRESSES TO REPLACE WITH
WETH_ADDRESS="0x8A7B847852f70c31B240D3E5aA2a1a8506C95494"
USDC_ADDRESS="0x05688B40cbdB7830dA9D8A1e50A765D39abAf96c"
USDT_ADDRESS="0xF25E9f0640635a262B1Ef51aC84d3f5896fE0642"
WBTC_ADDRESS="0xDf6FbD4AcADe82C6B78c85e47dBb992b3c4Db358"
DAI_ADDRESS="0x6EBFd1c028A19BA75E857d478E590e6aE9c7774e"
FACTORY_ADDRESS="0x28475d960C0F03129fE33B6281e4f55b125fD941"
SWAP_ROUTER_ADDRESS="0x0eCFf8bAf4FEDfEa1DBbeCDAefbB153EEa2670da"
POSITION_MANAGER_ADDRESS="0x67caa5670586B148c9a8c80C801DE0ff5F132199"
MULTICALL_ADDRESS="0x2fBc9cC2A8058D4E496ff66b38d98A37ccA53574"
QUOTER_ADDRESS="0x6AD8bf9d4C513c8d44dA2000a51069C7c27879e3"
V3_MIGRATOR_ADDRESS="0xBAa2C66A481d5D7bD57c38d8d05DCB4C2677eCef"
SUBGRAPH_URL="http://52.212.223.198:8000/subgraphs/name/ianlapham/uniswap-v3"
RPC_URL="https://sepolia.optimism.io/"

for FILE in "${FILES[@]}"; do
    sed -i \
    -e "s|$(escape_special_chars "$WETH_ADDRESS_")|$WETH_ADDRESS|gi" \
    -e "s|$(escape_special_chars "$USDC_ADDRESS_")|$USDC_ADDRESS|gi" \
    -e "s|$(escape_special_chars "$USDT_ADDRESS_")|$USDT_ADDRESS|gi" \
    -e "s|$(escape_special_chars "$WBTC_ADDRESS_")|$WBTC_ADDRESS|gi" \
    -e "s|$(escape_special_chars "$DAI_ADDRESS_")|$DAI_ADDRESS|gi" \
    -e "s|$(escape_special_chars "$USDC_OPTIMISM_MIGRATION3_")|$USDC_ADDRESS|gi" \
    -e "s|$(escape_special_chars "$FACTORY_ADDRESS_")|$FACTORY_ADDRESS|gi" \
    -e "s|$(escape_special_chars "$SWAP_ROUTER_ADDRESS_")|$SWAP_ROUTER_ADDRESS|gi" \
    -e "s|$(escape_special_chars "$POSITION_MANAGER_ADDRESS_")|$POSITION_MANAGER_ADDRESS|gi" \
    -e "s|$(escape_special_chars "$MULTICALL_ADDRESS_")|$MULTICALL_ADDRESS|gi" \
    -e "s|$(escape_special_chars "$QUOTER_ADDRESS_")|$QUOTER_ADDRESS|gi" \
    -e "s|$(escape_special_chars "$V3_MIGRATOR_ADDRESS_")|$V3_MIGRATOR_ADDRESS|gi" \
    -e "s|$(escape_special_chars "$SUBGRAPH_URL_")|$SUBGRAPH_URL|gi" \
    -e "s|$(escape_special_chars "$RPC_URL_")|$RPC_URL|gi" \
    "$FILE"
done

end_time=$(date +%s)
time_taken=$((end_time - start_time))
echo "Time taken: $time_taken seconds"
